{% extends "_base.html" %}
{% block content %}


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <title>TalkGPT</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='mobile.css') }}">

</head>
<style>

.start-recording-btn {
  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  border-radius: 10px;
}

.start-recording-btn:hover {
  background-color: #3e8e41; /* Darker green */
}

.ad-slot {
  border: 1px solid #ccc;
  padding: 10px;
  margin: 10px;
  text-align: center;
}

.ad-slot h3 {
  font-size: 18px;
  font-weight: bold;
  margin: 0 0 10px;
}

.ad-slot p {
  font-size: 14px;
  margin: 0;
}

</style>
<body>

            <div class="chat-header">
                <h1>TalkGPT</h1> <button id="start-recording-btn">Use Voice Recorder</button>
            </div>
            <div class="chat-messages">
                <p>If you would like to help fund Wiztech's hosting and further development costs, <a href="https://paystack.com/pay/wiztech" target="_blank"> please donate here</a>.  And for equity investment, please contact us at wiztech@gf4n.xyz.</p>

                 

                <ul id="messages">
                 
  <div class="chat-history">
    {% for message in chat_history %}
      <div class="message {% if message.user %}user{% else %}chatbot{% endif %}">
        <div class="avatar">
          {% if message.user %}
            <img src="{{ message.user.profile_picture }}" alt="{{ message.user.username }} profile picture">
          {% else %}
            <img src="{{ url_for('static', filename='chatbot-icon.png') }}" alt="Chatbot icon">
          {% endif %}
        </div>
        <div class="message-content">
          <div class="username">{% if message.user %}{{ message.user.username }}{% else %}t{% endif %}</div>
          <p>{{ message.content }}</p>
        </div>
      </div>
    {% endfor %}
  </div>
<script>
  $(document).ready(function() {
  $.get("/chat_history", function(data) {
      // populate chat history using response data
      // for example, you could loop through each message in the response data
      // and append it to the chat history section of your HTML
  });
});

fetch('/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ message: message, chat_history: chat_history })
})
  .then(response => response.json())
  .then(data => {
    console.log('Received response:', data);
    // handle the response data here
  });
</script>


  <style>
    .message {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .avatar {
      margin-right: 10px;
    }

    .message-content {
      display: flex;
      flex-direction: column;
    }

    .username {
      font-weight: bold;
      margin-bottom: 5px;
    }

    p {
      margin: 0;
    }

    .user .username {
      color: blue;
    }

    .chatbot .username {
      color: red;
    }
  </style>


                </ul>

                <!-- Facebook Share Button -->
<div class="fb-share-button" data-href="{{ url }}" data-layout="button" data-size="small">
    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u={{ url }}" class="fb-xfbml-parse-ignore">Share</a>
</div>

<!-- Load the Facebook SDK -->
<script>
    window.fbAsyncInit = function() {
        FB.init({
            appId: '{{ app_id }}',
            xfbml: true,
            version: 'v12.0'
        });
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
            </div>
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Enter your queries here..." style="height: 30px; min-height: 30px;" oninput="this.style.height = (this.scrollHeight > this.clientHeight) ? (this.scrollHeight + 'px') : '30px';">
                <button id="send-btn">Send</button>
            </div>



        
        <script type="text/javascript" src="{{ url_for('static', filename='app.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='profile.js') }}"></script>
</body>

{% endblock %}  